meta {
  name: Create a chat completion
  type: http
  seq: 1
}

post {
  url: {{baseUrl}}/chat/completions
  body: json
  auth: inherit
}

body:json {
  {
    "model": "",
    "messages": [
      {
        "role": "",
        "content": "",
        "name": "",
        "tool_calls": [
          {
            "id": "",
            "type": "",
            "function": {
              "name": "",
              "arguments": ""
            }
          }
        ],
        "tool_call_id": ""
      }
    ],
    "frequency_penalty": 0,
    "logit_bias": {},
    "logprobs": false,
    "top_logprobs": 0,
    "max_tokens": 0,
    "n": 0,
    "presence_penalty": 0,
    "response_format": {
      "type": ""
    },
    "seed": 0,
    "stop": "",
    "stream": false,
    "temperature": 0,
    "top_p": 0,
    "tools": [
      {
        "type": "",
        "function": {
          "name": "",
          "description": "",
          "parameters": {}
        }
      }
    ],
    "tool_choice": "",
    "user": ""
  }
}

example {
  name: Basic chat completion response (Basic chat completion request)
  
  request: {
    url: {{baseUrl}}/chat/completions
    method: POST
    mode: json
    body:json: {
      {
        "model": "gpt-3.5-turbo",
        "messages": [
          {
            "role": "system",
            "content": "You are a helpful assistant."
          },
          {
            "role": "user",
            "content": "Hello!"
          }
        ]
      }
    }
  }
  
  response: {
    headers: {
      Content-Type: application/json
    }
  
    status: {
      code: 200
      text: OK
    }
  
    body: {
      type: json
      content: '''
        {
          "id": "chatcmpl-123",
          "object": "chat.completion",
          "created": 1677652288,
          "model": "gpt-3.5-turbo-0613",
          "system_fingerprint": "fp_44709d6fcb",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": "\n\nHello there, how may I assist you today?"
              },
              "logprobs": null,
              "finish_reason": "stop"
            }
          ],
          "usage": {
            "prompt_tokens": 9,
            "completion_tokens": 12,
            "total_tokens": 21
          }
        }
      '''
    }
  }
}

example {
  name: Basic chat completion response (Chat completion request with function calling)
  
  request: {
    url: {{baseUrl}}/chat/completions
    method: POST
    mode: json
    body:json: {
      {
        "model": "gpt-3.5-turbo",
        "messages": [
          {
            "role": "user",
            "content": "What is the weather like in Boston?"
          }
        ],
        "tools": [
          {
            "type": "function",
            "function": {
              "name": "get_current_weather",
              "description": "Get the current weather in a given location",
              "parameters": {
                "type": "object",
                "properties": {
                  "location": {
                    "type": "string",
                    "description": "The city and state, e.g. San Francisco, CA"
                  },
                  "unit": {
                    "type": "string",
                    "enum": [
                      "celsius",
                      "fahrenheit"
                    ]
                  }
                },
                "required": [
                  "location"
                ]
              }
            }
          }
        ],
        "tool_choice": "auto"
      }
    }
  }
  
  response: {
    headers: {
      Content-Type: application/json
    }
  
    status: {
      code: 200
      text: OK
    }
  
    body: {
      type: json
      content: '''
        {
          "id": "chatcmpl-123",
          "object": "chat.completion",
          "created": 1677652288,
          "model": "gpt-3.5-turbo-0613",
          "system_fingerprint": "fp_44709d6fcb",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": "\n\nHello there, how may I assist you today?"
              },
              "logprobs": null,
              "finish_reason": "stop"
            }
          ],
          "usage": {
            "prompt_tokens": 9,
            "completion_tokens": 12,
            "total_tokens": 21
          }
        }
      '''
    }
  }
}

example {
  name: Chat completion response with function call (Basic chat completion request)
  
  request: {
    url: {{baseUrl}}/chat/completions
    method: POST
    mode: json
    body:json: {
      {
        "model": "gpt-3.5-turbo",
        "messages": [
          {
            "role": "system",
            "content": "You are a helpful assistant."
          },
          {
            "role": "user",
            "content": "Hello!"
          }
        ]
      }
    }
  }
  
  response: {
    headers: {
      Content-Type: application/json
    }
  
    status: {
      code: 200
      text: OK
    }
  
    body: {
      type: json
      content: '''
        {
          "id": "chatcmpl-abc123",
          "object": "chat.completion",
          "created": 1699896916,
          "model": "gpt-3.5-turbo-0613",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": null,
                "tool_calls": [
                  {
                    "id": "call_abc123",
                    "type": "function",
                    "function": {
                      "name": "get_current_weather",
                      "arguments": "{\"location\": \"Boston, MA\"}"
                    }
                  }
                ]
              },
              "logprobs": null,
              "finish_reason": "tool_calls"
            }
          ],
          "usage": {
            "prompt_tokens": 82,
            "completion_tokens": 17,
            "total_tokens": 99
          }
        }
      '''
    }
  }
}

example {
  name: Chat completion response with function call (Chat completion request with function calling)
  
  request: {
    url: {{baseUrl}}/chat/completions
    method: POST
    mode: json
    body:json: {
      {
        "model": "gpt-3.5-turbo",
        "messages": [
          {
            "role": "user",
            "content": "What is the weather like in Boston?"
          }
        ],
        "tools": [
          {
            "type": "function",
            "function": {
              "name": "get_current_weather",
              "description": "Get the current weather in a given location",
              "parameters": {
                "type": "object",
                "properties": {
                  "location": {
                    "type": "string",
                    "description": "The city and state, e.g. San Francisco, CA"
                  },
                  "unit": {
                    "type": "string",
                    "enum": [
                      "celsius",
                      "fahrenheit"
                    ]
                  }
                },
                "required": [
                  "location"
                ]
              }
            }
          }
        ],
        "tool_choice": "auto"
      }
    }
  }
  
  response: {
    headers: {
      Content-Type: application/json
    }
  
    status: {
      code: 200
      text: OK
    }
  
    body: {
      type: json
      content: '''
        {
          "id": "chatcmpl-abc123",
          "object": "chat.completion",
          "created": 1699896916,
          "model": "gpt-3.5-turbo-0613",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": null,
                "tool_calls": [
                  {
                    "id": "call_abc123",
                    "type": "function",
                    "function": {
                      "name": "get_current_weather",
                      "arguments": "{\"location\": \"Boston, MA\"}"
                    }
                  }
                ]
              },
              "logprobs": null,
              "finish_reason": "tool_calls"
            }
          ],
          "usage": {
            "prompt_tokens": 82,
            "completion_tokens": 17,
            "total_tokens": 99
          }
        }
      '''
    }
  }
}
